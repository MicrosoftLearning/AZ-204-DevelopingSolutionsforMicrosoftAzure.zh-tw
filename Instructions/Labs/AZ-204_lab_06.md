---
lab:
  az204Title: 'Lab 06: Authenticate by using OpenID Connect, MSAL, and .NET SDKs'
  az020Title: 'Lab 06: Authenticate by using OpenID Connect, MSAL, and .NET SDKs'
  az204Module: 'Module 06: Implement user authentication and authorization'
  az020Module: 'Module 06: Implement user authentication and authorization'
ms.openlocfilehash: 7b4ef25924a63d3bb28a8dd5632e9f35e5b4ba52
ms.sourcegitcommit: ddc44a8b5edc7ce2d93849bcab6c6a83dee1c99b
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/29/2022
ms.locfileid: "145196046"
---
# <a name="lab-06-authenticate-by-using-openid-connect-msal-and-net-sdks"></a>實驗 06：使用 OpenID Connect、MSAL 和 .NET SDK 驗證

## <a name="microsoft-azure-user-interface"></a>Microsoft Azure 使用者介面

基於 Microsoft 雲端工具的動態性質，您可能會遇到在本訓練內容開發後變更的 Azure UI。 因此，實驗指示可能無法正確對應實驗步驟。

當社群提醒 Microsoft 需要做修改時，我們會更新此訓練課程。 然而，雲端更新經常發生，所以您可能會在此訓練內容更新前遇到 UI 的變更。 **如果發生這種情況，請適應變更，然後視需要在實驗中調整。**

## <a name="instructions"></a>指示

### <a name="before-you-start"></a>在您開始使用 Intune 之前

#### <a name="sign-in-to-the-lab-environment"></a>登入實驗室環境

使用下列認證登入您的 Windows 10 虛擬機器 (VM)：
    
-   使用者名稱：**系統管理員**

-   密碼：**Pa55w.rd**

> **注意**：您的講師會提供連線至虛擬實驗室環境的指示。

#### <a name="review-the-installed-applications"></a>檢閱已安裝的應用程式

尋找 Windows 10 桌面上的工作列。 工作列包含此次實驗中會用到的應用程式圖示，包括：

-   Microsoft Edge

-   Visual Studio Code

## <a name="ensure-that-your-lab-environment-has-its-time-set-properly-no-delay-according-to-your-timezone"></a>請確保已正確設定實驗室環境時間 (根據您的時區，沒有延遲)

>**注意：** 如果您注意到實驗室環境的時間有延遲，請使用下列 powershell 命令增加 15 分鐘，調整其當地時間

```powershell
  Set-Date -Adjust (New-TimeSpan -Minutes 15)
```

## <a name="architecture-diagram"></a>架構圖

![說明使用者使用 OpenID Connect、MSAL 和 .NET SDK 驗證的結構圖。](./media/Lab06-Diagram.png)

### <a name="exercise-1-configure-a-single-tenant-azure-ad-environment"></a>練習 1：設定單一租用戶的 Azure AD 環境

#### <a name="task-1-open-the-azure-portal"></a>工作 1：開啟 Azure 入口網站

1. 在工作列上，選取 **Microsoft Edge** 圖示。

1. 在開啟的瀏覽器視窗中，瀏覽至 Azure 入口網站 ([portal.azure.com](https://portal.azure.com))，然後使用此實驗要使用的帳戶登入。

    > **注意**：如果這是您第一次登入 Azure 入口網站，系統會提供入口網站的導覽。 選取 [開始使用] 跳過導覽，並開始使用入口網站。

#### <a name="task-2-register-an-application-in-azure-ad"></a>工作 2：在 Azure AD 中註冊應用程式

1.  在 Azure 入口網站中，使用 [搜尋資源、服務及文件] 文字輸入框，搜尋 **Azure Active Directory**，然後在結果清單中選取 [Azure Active Directory]。 

    > **注意**：瀏覽器工作階段會重新導向 Azure 訂閱相關的 [Azure Active Directory (Azure AD) ] 租用戶窗格。

1.  在 [Azure Active Directory] 窗格上，選取 [管理] 區段中的 [應用程式註冊]。  

1.  在 [應用程式註冊] 區段中，選取 [+ 新增註冊]。 

1.  在 [註冊應用程式] 區段中，執行下列動作，然後選取 [註冊]： 

    | 設定 | 動作 |
    | --- | --- |
    | [名稱] 文字輸入框 | 輸入 **webappoidc** |
    | **支援的帳戶類型** 清單 | 選取 [僅限此組織目錄中的帳戶] \(僅限預設目錄 - 單一租用戶\) |

    下列螢幕擷取畫面顯示 **註冊應用程式** 區段中的設定。

     ![顯示設定註冊應用程式選項的螢幕擷取畫面。](./media/l06_aad_register_st_webapp.png)

#### <a name="task-3-record-unique-identifiers"></a>工作 3：記錄唯一識別碼

1.  在 [webappoidc] 應用程式註冊窗格上，選取 [概觀]。 

1.  在 [概觀] 區段中，尋找並記錄 [應用程式 (用戶端) 識別碼] 文字輸入框的值。  您會在稍後的實驗中用到此值。

1.  在 [概觀] 區段中，尋找並記錄 [目錄 (租用戶) 識別碼] 文字輸入框的值。  您會在稍後的實驗中用到此值。

#### <a name="task-4-configure-the-application-authentication-settings"></a>工作 4：設定應用程式驗證設定

1.  在 [webappoidc] 應用程式註冊窗格上，選取 [管理] 區段中的 [驗證]。  

1.  在 [驗證] 區段中，執行下列動作，然後選取 [設定]： 

    | 設定 | 動作 |
    | --- | --- |
    | [平台設定] 區段 | 選取 [+ 新增平台] |
    | [設定平台] 窗格  | 選取 [Web] |
    | [重新導向 URI] 文字輸入框 | 輸入 `https://localhost:44321/` |
    | [前端通道登出 URL] 文字輸入框   | 輸入 `https://localhost:44321/signout-oidc` |
        
1. 回到 [平台設定] 區段中，選取 [新增 URI]，然後輸入 `https://localhost:44321/signin-oidc`。 

1. 在 [隱含授與和混合式流程] 區段中，選取 [識別碼權杖] \(用於隱含和混合式流程\)。  

1. 選取 [儲存]。

    下列螢幕擷取畫面顯示 [驗證] 窗格上的設定。

     ![顯示 [驗證] 窗格上設定選項的螢幕擷取畫面。](./media/l06_aad_autentication_webapp.png)
       

#### <a name="task-5-create-an-azure-ad-user"></a>工作 5：建立 Azure AD 使用者

1.  在 Azure 入口網站中，選取 **Cloud Shell** 圖示 ![Cloud Shell 圖示](./media/az204_lab_CloudShell.png)，開啟新的 PowerShell 工作階段。 如果 Cloud Shell 預設為 Bash 工作階段，請選取 [Bash ]，然後在下拉式功能表中選取 [PowerShell]。

    > **注意**：如果這是您第一次啟動 **Cloud Shell**，當系統提示您選取 [Bash] 或 [PowerShell] 時，請選取 [PowerShell]。   系統顯示 **您未裝載儲存體** 訊息時，請選取此實驗中使用的訂閱，然後選取 [建立儲存體]。

1.  在 [Cloud Shell] 窗格中，執行下列命令，登入 Azure 訂閱相關的 Azure AD 租用戶：

    ```powershell
    Connect-AzureAD
    ```

1.  執行下列命令，擷取並顯示 Azure AD 租用戶的主要網域名稱系統 (DNS) 網域名稱：

    ```powershell
    $aadDomainName = ((Get-AzureAdTenantDetail).VerifiedDomains)[0].Name
    $aadDomainName
    ```

    > **注意**：記錄 DNS 網域名稱的值。 您會在稍後的實驗中用到此值。

1.  執行下列命令，建立用來測試 Azure AD 驗證的 Azure AD 使用者：

    ```powershell
    $passwordProfile = New-Object -TypeName Microsoft.Open.AzureAD.Model.PasswordProfile
    $passwordProfile.Password = 'Pa55w.rd1234'
    $passwordProfile.ForceChangePasswordNextLogin = $false
    New-AzureADUser -AccountEnabled $true -DisplayName 'aad_lab_user1' -PasswordProfile $passwordProfile -MailNickName 'aad_lab_user1' -UserPrincipalName "aad_lab_user1@$aadDomainName" 
    ```

1.  執行下列命令，識別新建立 Azure AD 使用者的使用者主體名稱 (UPN)：

    ```powershell
    (Get-AzureADUser -Filter "MailNickName eq 'aad_lab_user1'").UserPrincipalName
    ```

    > **注意**：記錄 UPN。 您會在稍後的實驗中用到此值。

1.  關閉 [Cloud Shell] 窗格。

#### <a name="review"></a>檢閱

在此練習中，您已註冊單一租用戶 Azure AD 應用程式，並建立 Azure AD 使用者帳戶。

### <a name="exercise-2-create-a-single-tenant-aspnet-core-web-app"></a>練習 2：建立單一租用戶 ASP.NET Core Web 應用程式

#### <a name="task-1-create-an-aspnet-core-web-app-project"></a>工作 1：建立 ASP.NET Core Web 應用程式專案

1.  在實驗用的電腦上，啟動 **Windows 終端機**。

1.  從命令提示字元，執行下列命令，建立並設定工作目錄至 **Allfiles (F):\\Allfiles\\Labs\\06\\Starter\\OIDCClient**：

    ```powershell
    F:
    md "F:\Allfiles\Labs\06\Starter\OIDCClient"
    ```

1.  執行下列命令，根據 Model View Controller (MVC) 範本，建立新的 .NET Core Web 應用程式 (以您之前在此實驗中記錄的對應值取代預留位置 `<application_ID>`、`<tenant_ID>` 和 `<domain_Name>`)：

    ```powershell
    dotnet new mvc --auth SingleOrg --client-id <application_ID> --tenant-id <tenant_ID> --domain <domain_Name>
    ```

1.  在實驗用的電腦上，啟動 Visual Studio Code。

1.  在 [檔案] 功能表中，選取 [開啟資料夾]。 

1.  在[檔案總管] 視窗中，瀏覽至 **Allfiles (F):\\Allfiles\\Labs\\06\\Starter\\OIDCClient**，然後選取 [選取資料夾]。

1.  在 Visual Studio Code 的[Explorer] 窗格中，檢閱代表 MVC Web 應用程式的自動產生資料夾結構。

1.  瀏覽至 [屬性] 資料夾，開啟 launchSettings.json 檔案，然後套用下列變更： 

    
    | 區段 | 屬性  | 值 |
    | --- | --- | --- |
    | **iisSettings** | **sslPort** | **44321** |
    | **OIDCClient**  | **applicationUrl** | `https://localhost:44321` |

    > **注意**：連接埠號碼必須符合建立 Azure AD 應用程式註冊時指定的值。

1.  儲存並關閉檔案。

1.  在 Visual Studio Code 的 [Explorer] 窗格中，選取 [OIDCClient.csproj]。 

1.  確定 `<TargetFramework>` 元素的值已設為 **netcoreapp3.1**。

1.  將 `Microsoft.AspNetCore.Authentication.JwtBearer` 和 `Microsoft.AspNetCore.Authentication.OpenIdConnect` NuGet 封裝的版本設為 **3.1.18**。

1.  將 `Microsoft.Identity.Web` 和 `Microsoft.Identity.Web.UI` NuGet 封裝的版本設為 **0.3.1-preview**。

1.  移除 `<WebProject_DirectoryAccessLevelKey>0</WebProject_DirectoryAccessLevelKey>` 項目。

1.  移除 `<PackageReference Include="Microsoft.AspNetCore.Authentication.AzureAD.UI" Version="3.1.7" />` 項目。

1.  確認 **OIDCClient.csproj** 檔案的內容與下列清單類似 (`UserSecretsId` 的值會有所不同) 並儲存變更。

    ```csharp
    <Project Sdk="Microsoft.NET.Sdk.Web">
      <PropertyGroup>
        <TargetFramework>netcoreapp3.1</TargetFramework>
        <UserSecretsId>aspnet-OIDCClient-737DEB13-25D4-4C52-93C5-F485367E3C8C</UserSecretsId>
      </PropertyGroup>
      <ItemGroup>
        <PackageReference Include="Microsoft.AspNetCore.Authentication.JwtBearer" Version="3.1.18" NoWarn="NU1605" />
        <PackageReference Include="Microsoft.AspNetCore.Authentication.OpenIdConnect" Version="3.1.18" NoWarn="NU1605" />
        <PackageReference Include="Microsoft.Identity.Web" Version="0.3.1-preview" />
        <PackageReference Include="Microsoft.Identity.Web.UI" Version="0.3.1-preview" />
      </ItemGroup>
    </Project>
    ```

1.  關閉 OIDCClient.csproj 檔案。

1.  瀏覽至 [Views\Shared] 資料夾，然後開啟 **_LoginPartial.cshtml** 檔案。

1.  將下列程式碼中的 `AzureAD` 取代為 `MicrosoftIdentity`：

    ```csharp
    <a class="nav-link text-dark" asp-area="AzureAD" asp-controller="Account" asp-action="SignOut">Sign out</a>`
    ```

1.  將下列程式碼中的 `AzureAD` 取代為 `MicrosoftIdentity`：

    ```csharp
    <a class="nav-link text-dark" asp-area="AzureAD" asp-controller="Account" asp-action="SignIn">Sign in</a>
    ```

1.  儲存並關閉檔案。

1.  開啟 appsettings.json 檔案，並檢閱 **AzureAd** 物件的內容，包括下列元素：

    | 元素 | 值 |
    | --- | --- |
    | `Instance` | `https://login.microsoftonline.com/` |
    | `Domain` | Azure 訂閱相關的 Azure AD 租用戶主要 DNS 網域。 |
    | `TenantId` | Azure AD 租用戶 GUID。 |
    | `ClientId` | Azure AD 租用戶中註冊的應用程式 (用戶端) 識別碼。 |
    | `CallbackPath` | `/signin-oidc` |

1.  不做任何變更，將檔案關閉。

1.  在 Visual Studio Code [Explorer] 窗格中，選取 [Startup.cs]。 

1.  移除 `using Microsoft.AspNetCore.Authentication.AzureAD.UI;` 指示詞。

1.  在上一個步驟中移除項目後，直接新增下列 **using** 指示詞：

    ```csharp
    using Microsoft.AspNetCore.Authentication.OpenIdConnect;
    using Microsoft.Identity.Web;
    using Microsoft.Identity.Web.UI;
    ```

1.  移除下列各行：

    ```csharp
    services.AddAuthentication(AzureADDefaults.AuthenticationScheme)
      .AddAzureAD(options => Configuration.Bind("AzureAd", options));
    ```

1.  以下列程式碼取代您在最後一個步驟中移除的程式碼：

    ```csharp
    services.AddAuthentication(OpenIdConnectDefaults.AuthenticationScheme)
      .AddMicrosoftIdentityWebApp(Configuration.GetSection("AzureAd"));
    ```

1.  移除下列程式碼：

    ```csharp
    services.AddRazorPages();
    ```

1.  以下列程式碼取代您在最後一個步驟中移除的程式碼：

    ```csharp
    services.AddRazorPages()
      .AddMicrosoftIdentityUI();
    ```

1.  儲存並關閉檔案。

### <a name="task-2-test-the-single-tenant-web-app-in-a-single-tenant-scenario"></a>工作 2：在單一租用戶案例中，測試單一租用戶 Web 應用程式

1.  在 [Visual Studio Code] 視窗中，啟用 [Explorer] 窗格的捷徑功能表，然後選取 [在整合式終端中開啟]。  

1.  執行下列命令組建 .NET Web 應用程式：

    ```
    dotnet build
    ```

    > **注意**：如果有任何建置錯誤，請檢閱 **Allfiles (F):\\Allfiles\\Labs\\06\\Solution\\OIDCClient** 資料夾中的檔案。

1.  執行下列命令，產生自我簽署憑證，並將本機電腦設為信任該憑證：

    ```
    dotnet dev-certs https --trust
    ```

1.  系統提示安裝自動產生的憑證時，請選取 [是]。

1.  從終端機提示字元，執行下列命令以執行 .NET Web 應用程式：

    ```
    dotnet run
    ```

1.  在 **InPrivate** 模式下，啟動 Microsoft Edge 瀏覽器，然後瀏覽至 `https://localhost:44321` URL。

1.  如果顯示 **您的連線不是私人連線** 訊息，請選取 [進階]，然後選取 [繼續前往 localhost] \(不安全\) 連結。 

1.  在開啟的瀏覽器視窗中出現提示後，請使用您之前在此實驗建立的 **aad_lab_user1** Azure AD 帳戶 UPN 進行驗證，密碼為 **Pa55w.rd1234**。

    > **注意**：如果系統提示 [協助我們保護您的帳戶] 視窗，請選取 [暫時跳過]。 

1.  瀏覽器視窗會自動開啟 [要求的權限] 網頁。

1.  檢閱要求的權限，包括 **檢視您的基本設定檔** 和 **維護您授與存取的資料存取權**。

1.  選取 [接受]。

1.  檢閱瀏覽器顯示的目標網站 **歡迎** 首頁，並確認 **aad_user1** Azure AD 帳戶 UPN 顯示在瀏覽器視窗中。

1.  在 **歡迎** 頁面上，選取 [登出]。

1.  系統提示選取要登出的帳戶時，請選取 **aad_lab_user1** Azure AD 帳戶。 系統會自動重新導向 **已登出** 的頁面。

1.  將顯示 **已登出** 頁面的 Microsoft Edge 瀏覽器保持開啟。

#### <a name="review"></a>檢閱 

在此練習中，您已實作單一租用戶 Web 應用程式，並在單一租用戶 Azure 環境中測試此應用程式。

### <a name="exercise-3-configure-a-multitenant-azure-ad-environment"></a>練習 3：設定多租用戶 Azure AD 環境

#### <a name="task-1-create-an-azure-ad-tenant"></a>工作 1：建立 Azure AD 租用戶

1.  切換至顯示 Azure 入口網站的 Microsoft Edge 瀏覽器。

1.  在 Azure 入口網站中，瀏覽至 [Azure Active Directory] 窗格。

1.  在 [Azure Active Directory] 窗格上，選取 [管理租用戶]，然後選取 [+ 建立]。  

1.  在 [建立租用戶] 窗格的 [基本] 索引標籤上，確認已選取 [Azure Active Directory] 選項，然後選取 [下一步:   **設定] >。**

1.  在 [建立租用戶] 刀鋒視窗的 [設定] 索引標籤上，指定下列設定：

    | 設定 | 值 |
    | --- | --- |
    | 組織名稱 | **Contoso** |
    | 初始網域名稱 | 任何以字母開頭並由小寫字母和數字組成的有效 DNS 名稱。 |
    | 國家/地區 | 您的國家或地區名稱。 |

1.  選取 [檢閱 + 建立]，然後選取 [建立]。

1.  如果出現提示，請在 [請協助我們證明您不是機器人] 中輸入提供的代碼，然後選取 [提交]。

1.  等候佈建完成，然後選取 [Contoso] 連結，瀏覽至顯示 Contoso Azure AD 租用戶屬性的窗格。

1.  在 Azure AD 租用戶的 [概觀] 窗格中，識別並記錄 **租用戶識別碼** 屬性的值。 您會在稍後的實驗中用到此值。

#### <a name="task-2-create-an-azure-ad-user"></a>工作 2：建立 Azure AD 使用者

1.  在顯示 Azure 入口網站的網頁瀏覽器視窗中，選取 [目錄 + 訂閱] 工具列圖示。

1.  在 [入口網站設定 | 目錄 + 訂閱] 窗格中，在代表與訂閱相關的 Azure AD 租用戶項目旁，選取 [切換]。 

1.  在 Azure 入口網站中，選取 Cloud Shell 圖示，開啟新的 PowerShell 工作階段。 

1.  在 [Cloud Shell] 窗格中，執行下列命令，登入 Contoso Azure AD 租用戶。 用上一個工作中所識別的租用戶識別碼屬性值來取代 `<tenant_Id>` 預留位置：

    ```powershell
    Import-Module AzureAD.Standard.Preview
    AzureAD.Standard.Preview\Connect-AzureAD -TenantID '<tenant_ID>'
    ```

1.  Ctrl + 按一下警告中的 URL，開啟瀏覽器視窗，並遵循步驟進行驗證。  

1.  執行下列命令，擷取 Azure AD 租用戶的 DNS 網域名稱：

    ```powershell
    $aadDomainName = ((Get-AzureAdTenantDetail).VerifiedDomains)[0].Name
    ```

1.  執行下列命令，建立用來測試 Azure AD 驗證的 Azure AD 使用者：

    ```powershell
    $passwordProfile = New-Object -TypeName Microsoft.Open.AzureAD.Model.PasswordProfile
    $passwordProfile.Password = 'Pa55w.rd1234'
    $passwordProfile.ForceChangePasswordNextLogin = $false
    New-AzureADUser -AccountEnabled $true -DisplayName 'aad_lab_user2' -PasswordProfile $passwordProfile -MailNickName 'aad_lab_user2' -UserPrincipalName "aad_lab_user2@$aadDomainName"
    ```

1.  執行下列命令，識別新建立 Azure AD 使用者的 UPN：

    ```powershell
    (Get-AzureADUser -Filter "MailNickName eq 'aad_lab_user2'").UserPrincipalName
    ```

    > **注意**：記錄 UPN。 您會在稍後的實驗中用到此值。

1.  關閉 [Cloud Shell] 窗格。

#### <a name="task-3-test-the-single-tenant-web-app-in-a-multitenant-scenario"></a>工作 3：在多租用戶案例中，測試單一租用戶 Web 應用程式

1.  切換回 Microsoft Edge 瀏覽器 (在 **InPrivate** 模式下並顯示 **已登出** 頁面) 然後選取 [登入]。

1.  在開啟的瀏覽器視窗中出現提示後，請使用您之前在此實驗建立的 **aad_lab_user2** Azure AD 帳戶 UPN 進行驗證，密碼為 **Pa55w.rd1234**。

1.  請注意錯誤訊息指出您使用的使用者帳戶不存在 **webappoidc** Web 應用程式註冊的租用戶中。

    > **注意**：若要此案例中的登入可以運作，請先以外部使用者身分，新增此帳戶至裝載 webappoidc Web 應用程式註冊的租用戶。

1.  關閉顯示錯誤訊息的 Microsoft Edge 瀏覽器，然後切換回 [Visual Studio Code] 視窗。

1.  在 [終端] 窗格中，選取 [終止終端] \(**資源回收筒** 圖示\)，關閉目前開啟的終端和任何相關的程序。 

#### <a name="review"></a>檢閱

在此練習中，您已設定多租用戶 Azure 環境，並使用單一租用戶 Web 應用程式測試。

### <a name="exercise-4-configure-a-multitenant-aspnet-core-web-app"></a>練習 4：設定多租用戶 ASP.NET Core Web 應用程式

#### <a name="task-1-configure-the-application-registration-in-azure-ad"></a>工作 1：設定 Azure AD 中的應用程式註冊

1.  切換至 Azure 入口網站，然後選取 [目錄 + 訂閱] 工具列圖示。

1.  在 [入口網站設定 | 目錄 + 訂閱] 窗格中，在代表與訂閱相關的 Azure AD 租用戶項目旁，選取 [切換]。 

1.  在 [Azure Active Directory] 窗格上，選取 [管理] 區段中的 [應用程式註冊]。  

1.  在應用程式註冊清單中，選取 [webappoidc]。

1.  在 [webappoidc] 應用程式註冊窗格上，選取 [管理] 區段中的 [驗證]。  

1.  在 [支援的帳戶類型] 區段中，選取 [任何組織目錄中的帳戶] \(任何 Azure AD 目錄 - 多租用戶\)。 

1.  選取 [儲存]。

    下列螢幕擷取畫面顯示 **應用程式註冊** 窗格上的設定。
          
     ![顯示應用程式註冊窗格上設定選項的螢幕擷取畫面。](./media/l06_aad_register_mt_webapp.png)

    
#### <a name="task-2-configure-multi-tenancy-support-of-the-aspnet-core-web-app"></a>工作 2：設定 ASP.NET Core Web 應用程式的多租用戶支援

1.  在實驗用的電腦上，啟動 Visual Studio Code。

1.  開啟 **appsettings.json** 檔案。

1.  以下列程式碼取代包含 `TenantId` 元素的程式碼：

    ```
    "TenantId": "organizations", 
    ```

1.  儲存並關閉檔案。

### <a name="task-3-test-the-multitenant-web-app-in-a-multitenant-scenario"></a>工作 3：在多租用戶案例中，測試多租用戶 Web 應用程式

1.  在 [Visual Studio Code] 視窗中，啟用 [Explorer] 窗格的捷徑功能表，然後選取 [在整合式終端中開啟]。  

1.  從終端機提示字元，執行下列命令以執行 .NET Web 應用程式：

    ```
    dotnet run
    ```

1.  在 **InPrivate** 模式下，啟動 Microsoft Edge 瀏覽器，然後瀏覽至 `https://localhost:44321` URL。

1.  如果顯示 **您的連線不是私人連線** 訊息，請選取 [進階]，然後選取 [繼續前往 localhost] \(不安全\) 連結。 

1.  在開啟的瀏覽器視窗中出現提示後，請使用您之前在此實驗建立的 **aad_lab_user1** Azure AD 帳戶 UPN 進行驗證，密碼為 **Pa55w.rd1234**。

1.  檢閱瀏覽器顯示的目標網站 **歡迎** 首頁，並確認 **aad_lab_user1** Azure AD 帳戶 UPN 顯示在瀏覽器視窗中。

1.  在 **歡迎** 頁面上，選取 [登出]。

1.  系統提示選取要登出的帳戶時，請選取 **aad_lab_user1** Azure AD 帳戶。 系統會自動重新導向 **已登出** 的頁面。

1.  在顯示 **已登出** 頁面的 Microsoft Edge 瀏覽器中，選取 [登入]。

1.  在開啟的瀏覽器視窗中出現提示後，請使用您之前在此實驗建立的 **aad_lab_user2** Azure AD 帳戶 UPN 進行驗證，密碼為 **Pa55w.rd1234**。

1.  瀏覽器視窗會自動開啟 [要求的權限] 網頁。

1.  檢閱要求的權限，包括 **檢視您的基本設定檔** 和 **維護您授與存取的資料存取權**。

1.  選取 [接受]。

    > **注意**：應用程式會列為未驗證。 這是預料中的結果，因為您在此實驗使用的應用程式範例尚未經過發行者驗證。 如需詳細資訊，請參閱描述[發行者驗證](https://docs.microsoft.com/en-us/azure/active-directory/develop/publisher-verification-overview)的 Microsoft 文件。

1.  檢閱瀏覽器顯示的目標網站 **歡迎** 首頁，並確認 **aad_lab_user2** Azure AD 帳戶 UPN 顯示在瀏覽器視窗中。

1.  在 **歡迎** 頁面上，選取 [登出]。

1.  關閉 **InPrivate** 模式的 Microsoft Edge 瀏覽器，然後切換回 [Visual Studio Code] 視窗。

1.  在 [終端] 窗格中，選取 [終止終端] \(**資源回收筒** 圖示\)，關閉目前開啟的終端和任何相關的程序。 

#### <a name="review"></a>檢閱

在此練習中，您已實作多租用戶 Web 應用程式，並在多租用戶 Azure 環境中測試。

### <a name="exercise-5-clean-up-your-subscription"></a>練習 5：清除訂閱

#### <a name="task-1-delete-the-application-registration-in-azure-ad"></a>工作 1：刪除 Azure AD 中的應用程式註冊

1.  切換至顯示 Azure 入口網站的 Microsoft Edge 瀏覽器。

1.  在 Azure 入口網站中，瀏覽至 [Contoso Azure AD] 租用戶窗格。 這會顯示 [Contoso \| 概觀] 窗格。

1.  在 [Azure Active Directory] 窗格中，選取 [管理] 區段中的 [企業應用程式]。  

1.  在 [企業應用程式 \| 所有應用程式] 窗格中，選取 [webappoidc]。 

1.  在 [webappoidc \| 概觀] 窗格中，選取 [屬性]。 

1.  在 [webappoidc \| 屬性] 窗格中，選取 [刪除]，並在系統提示確認時，選取 [是]。  

1.  瀏覽至 Contoso Azure AD 租用戶的 [使用者 \| 所有使用者] \(預覽\) 窗格。

1.  在使用者清單中，選取 [aad_lab_user2]。

1.  在 [aad_lab_user2 \| 設定檔] 窗格中，選取 [刪除]，然後在系統提示確認時，選取 [是]。  

1.  瀏覽回到 [Contoso \| 概觀] 窗格，然後選取 [管理租用戶]。 

1.  在租用戶清單中，選取 [Contoso] \(預設\) 項目旁的核取方塊，然後選取 [刪除]。 

1.  在 [刪除租用戶 'Contoso'?] 窗格上，選取 [刪除]。

1.  如有必要，請選取 [取得刪除 Azure 資源的權限]，在 [存取 Azure 資源的管理] 中 Azure AD 租用戶的 [屬性] 窗格上，選取 [是]，然後選取 [儲存]。    

1.  瀏覽回到 [刪除租用戶 'Contoso'?] 窗格，重新整理瀏覽器頁面，選取 [刪除]，然後選取 [是] 確認。 

1.  在 Azure 入口網站中，瀏覽回到 Azure 訂閱相關的 Azure AD 租用戶窗格。

1.  在 [Azure Active Directory] 窗格上，選取 [管理] 區段中的 [應用程式註冊]。  

1.  在 [應用程式註冊] 區段中，選取之前在此實驗建立的 [webappoidc] Azure AD 應用程式註冊。 

1.  在 [webappoidc] 區段中，執行下列動作：

    a. 選取 [刪除]。

    b. 在 [刪除應用程式註冊] 窗格中，選取 [我了解刪除此應用程式註冊的含意]，然後選取 [刪除]。  

1.  瀏覽至 [使用者 \| 所有使用者] \(預覽\) 窗格。

1.  在使用者清單中，選取 [aad_lab_user1]

1.  在 [aad_lab_user1 \| 設定檔] 窗格中，選取 [刪除]，然後在系統提示確認時，選取 [是]。  

#### <a name="task-2-close-the-active-applications"></a>工作 2：關閉作用中的應用程式

1.  關閉任何開啟的 Microsoft Edge 視窗。

1.  關閉 Visual Studio Code。

#### <a name="review"></a>檢閱

在此練習中，您已移除此實驗中使用的應用程式註冊，並清除了您的訂閱。
